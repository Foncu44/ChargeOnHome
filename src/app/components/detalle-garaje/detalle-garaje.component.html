<div class="detalle-garaje-container" *ngIf="garaje && !isLoading">
  <!-- Header -->
  <mat-toolbar class="app-toolbar">
    <button mat-icon-button routerLink="/mapa" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <img src="/assets/images/ChargeOnHouse Logo.png" alt="ChargeOnHouse Logo" class="logo-small">
    <span class="spacer"></span>
  </mat-toolbar>

  <!-- Contenido principal -->
  <div class="main-content">
    <!-- Galería de fotos -->
    <div class="fotos-section" *ngIf="garaje.fotos && garaje.fotos.length > 0">
      <div class="foto-principal">
        <img [src]="garaje.fotos[fotoActual]" [alt]="garaje.direccion">
        <button mat-icon-button class="nav-foto prev" (click)="anteriorFoto()" *ngIf="garaje.fotos.length > 1">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-icon-button class="nav-foto next" (click)="siguienteFoto()" *ngIf="garaje.fotos.length > 1">
          <mat-icon>chevron_right</mat-icon>
        </button>
        <div class="foto-indicators" *ngIf="garaje.fotos.length > 1">
          <span *ngFor="let foto of garaje.fotos; let i = index" 
                [class.active]="i === fotoActual"
                (click)="fotoActual = i"></span>
        </div>
      </div>
    </div>

    <!-- Información principal -->
    <div class="info-container">
      <div class="info-main">
        <!-- Título y subtítulo -->
        <div class="header-info">
          <h1 class="titulo-casa">Casa de {{ garaje.direccion.split(',')[0] }}</h1>
          <p class="subtitulo-carga">
            Disponible para {{ garaje.potenciaCarga >= 22 ? 'carga rápida' : 'carga estándar' }}
          </p>
          <div class="price-section">
            <span class="price-main">{{ garaje.precioElectricidad }}€/kWh</span>
          </div>
        </div>

        <!-- Sección de detalles -->
        <div class="detalles-section">
          <div class="detalle-item">
            <mat-icon>attach_money</mat-icon>
            <div class="detalle-content">
              <span class="detalle-label">Precio por kWh</span>
              <span class="detalle-value">{{ garaje.precioElectricidad }}€/kWh</span>
            </div>
          </div>
          
          <div class="detalle-item">
            <mat-icon>schedule</mat-icon>
            <div class="detalle-content">
              <span class="detalle-label">Horarios disponibles</span>
              <span class="detalle-value">{{ garaje.disponible24h ? '24 horas' : 'Horario limitado' }}</span>
            </div>
          </div>
          
          <div class="detalle-item">
            <mat-icon>power</mat-icon>
            <div class="detalle-content">
              <span class="detalle-label">Tipo de conector</span>
              <span class="detalle-value">{{ getTipoConectorLabel(garaje.tipoConector) }}</span>
            </div>
          </div>
          
          <div class="detalle-item">
            <mat-icon>location_on</mat-icon>
            <div class="detalle-content">
              <span class="detalle-label">Distancia desde tu ubicación</span>
              <span class="detalle-value">Calculando...</span>
            </div>
          </div>
        </div>

        <!-- Descripción -->
        <mat-card class="descripcion-card" *ngIf="garaje.descripcion">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>description</mat-icon>
              Descripción
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ garaje.descripcion }}</p>
          </mat-card-content>
        </mat-card>

        <!-- Mapa -->
        <mat-card class="mapa-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>map</mat-icon>
              Ubicación
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="map-container">
              <google-map
                [center]="center"
                [zoom]="zoom"
                [options]="mapOptions"
                width="100%"
                height="400px">
                <map-marker
                  *ngIf="markerPosition"
                  [position]="markerPosition">
                </map-marker>
              </google-map>
            </div>
            <p class="direccion-completa">
              <mat-icon>location_on</mat-icon>
              {{ garaje.direccion }}
            </p>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Panel de reserva -->
      <div class="reserva-panel">
        <mat-card class="reserva-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>event</mat-icon>
              Reservar Garaje
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="reservaForm" (ngSubmit)="crearReserva()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Fecha y hora inicio</mat-label>
                <input matInput type="datetime-local" formControlName="fechaInicio" required>
                <mat-icon matSuffix>event</mat-icon>
                <mat-error *ngIf="reservaForm.get('fechaInicio')?.hasError('required')">
                  Obligatorio
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Fecha y hora fin</mat-label>
                <input matInput type="datetime-local" formControlName="fechaFin" required>
                <mat-icon matSuffix>event</mat-icon>
                <mat-error *ngIf="reservaForm.get('fechaFin')?.hasError('required')">
                  Obligatorio
                </mat-error>
              </mat-form-field>

              <button mat-raised-button color="accent" type="button" 
                      (click)="calcularPrecio()" 
                      [disabled]="!reservaForm.valid"
                      class="full-width calcular-button">
                <mat-icon>calculate</mat-icon>
                Calcular Precio
              </button>

              <!-- Desglose de precio -->
              <div class="precio-desglose" *ngIf="calculoPrecio">
                <div class="precio-item">
                  <span>Alquiler garaje ({{ calculoPrecio.horas | number:'1.1-1' }}h)</span>
                  <span>{{ calculoPrecio.precioGaraje | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-item">
                  <span>Electricidad</span>
                  <span>{{ calculoPrecio.precioElectricidad | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-item">
                  <span>Comisión plataforma (20%)</span>
                  <span>{{ calculoPrecio.comisionPlataforma | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-total">
                  <span>Total</span>
                  <span>{{ calculoPrecio.precioTotal | number:'1.2-2' }}€</span>
                </div>
              </div>

              <button mat-raised-button type="submit" 
                      [disabled]="!reservaForm.valid || !calculoPrecio"
                      class="full-width reservar-button btn-reservar">
                <mat-icon>bolt</mat-icon>
                Reservar carga
              </button>
              
              <button mat-stroked-button type="button" 
                      class="full-width btn-contactar"
                      (click)="contactarAnfitrion()">
                <mat-icon>chat</mat-icon>
                Contactar anfitrión
              </button>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>

<!-- Loading -->
<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
  <p>Cargando información del garaje...</p>
</div>
