<div class="detalle-garaje-container" *ngIf="garaje && !isLoading">
  <!-- Header -->
  <mat-toolbar color="primary" class="app-toolbar">
    <button mat-icon-button routerLink="/mapa" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="logo">
      <mat-icon>home</mat-icon>
      Detalle del Garaje
    </span>
    <span class="spacer"></span>
  </mat-toolbar>

  <!-- Contenido principal -->
  <div class="main-content">
    <!-- Galería de fotos -->
    <div class="fotos-section" *ngIf="garaje.fotos && garaje.fotos.length > 0">
      <div class="foto-principal">
        <img [src]="garaje.fotos[fotoActual]" [alt]="garaje.direccion">
        <button mat-icon-button class="nav-foto prev" (click)="anteriorFoto()" *ngIf="garaje.fotos.length > 1">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-icon-button class="nav-foto next" (click)="siguienteFoto()" *ngIf="garaje.fotos.length > 1">
          <mat-icon>chevron_right</mat-icon>
        </button>
        <div class="foto-indicators" *ngIf="garaje.fotos.length > 1">
          <span *ngFor="let foto of garaje.fotos; let i = index" 
                [class.active]="i === fotoActual"
                (click)="fotoActual = i"></span>
        </div>
      </div>
    </div>

    <!-- Información principal -->
    <div class="info-container">
      <div class="info-main">
        <!-- Título y precio -->
        <div class="header-info">
          <h1>{{ garaje.direccion }}</h1>
          <div class="price-section">
            <span class="price-main">{{ garaje.precioPorHora }}€/h</span>
            <span class="price-note">+ electricidad + 20% comisión</span>
          </div>
        </div>

        <!-- Características principales -->
        <div class="caracteristicas-grid">
          <div class="caracteristica-item">
            <mat-icon>electrical_services</mat-icon>
            <div>
              <span class="label">Potencia</span>
              <span class="value">{{ garaje.potenciaCarga }} kW</span>
            </div>
          </div>
          <div class="caracteristica-item">
            <mat-icon>power</mat-icon>
            <div>
              <span class="label">Conector</span>
              <span class="value">{{ getTipoConectorLabel(garaje.tipoConector) }}</span>
            </div>
          </div>
          <div class="caracteristica-item">
            <mat-icon>straighten</mat-icon>
            <div>
              <span class="label">Dimensiones</span>
              <span class="value">{{ garaje.ancho }}x{{ garaje.largo }}x{{ garaje.altura }}m</span>
            </div>
          </div>
          <div class="caracteristica-item">
            <mat-icon>square_foot</mat-icon>
            <div>
              <span class="label">Área</span>
              <span class="value">{{ calcularArea() | number:'1.2-2' }} m²</span>
            </div>
          </div>
          <div class="caracteristica-item">
            <mat-icon>schedule</mat-icon>
            <div>
              <span class="label">Disponibilidad</span>
              <span class="value">{{ garaje.disponible24h ? '24 horas' : 'Horario limitado' }}</span>
            </div>
          </div>
          <div class="caracteristica-item">
            <mat-icon>bolt</mat-icon>
            <div>
              <span class="label">Electricidad</span>
              <span class="value">{{ garaje.precioElectricidad }}€/kWh</span>
            </div>
          </div>
        </div>

        <!-- Descripción -->
        <mat-card class="descripcion-card" *ngIf="garaje.descripcion">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>description</mat-icon>
              Descripción
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ garaje.descripcion }}</p>
          </mat-card-content>
        </mat-card>

        <!-- Mapa -->
        <mat-card class="mapa-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>map</mat-icon>
              Ubicación
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="map-container">
              <google-map
                [center]="center"
                [zoom]="zoom"
                [options]="mapOptions"
                width="100%"
                height="400px">
                <map-marker
                  *ngIf="markerPosition"
                  [position]="markerPosition">
                </map-marker>
              </google-map>
            </div>
            <p class="direccion-completa">
              <mat-icon>location_on</mat-icon>
              {{ garaje.direccion }}
            </p>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Panel de reserva -->
      <div class="reserva-panel">
        <mat-card class="reserva-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>event</mat-icon>
              Reservar Garaje
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="reservaForm" (ngSubmit)="crearReserva()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Fecha y hora inicio</mat-label>
                <input matInput type="datetime-local" formControlName="fechaInicio" required>
                <mat-icon matSuffix>event</mat-icon>
                <mat-error *ngIf="reservaForm.get('fechaInicio')?.hasError('required')">
                  Obligatorio
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Fecha y hora fin</mat-label>
                <input matInput type="datetime-local" formControlName="fechaFin" required>
                <mat-icon matSuffix>event</mat-icon>
                <mat-error *ngIf="reservaForm.get('fechaFin')?.hasError('required')">
                  Obligatorio
                </mat-error>
              </mat-form-field>

              <button mat-raised-button color="accent" type="button" 
                      (click)="calcularPrecio()" 
                      [disabled]="!reservaForm.valid"
                      class="full-width calcular-button">
                <mat-icon>calculate</mat-icon>
                Calcular Precio
              </button>

              <!-- Desglose de precio -->
              <div class="precio-desglose" *ngIf="calculoPrecio">
                <div class="precio-item">
                  <span>Alquiler garaje ({{ calculoPrecio.horas | number:'1.1-1' }}h)</span>
                  <span>{{ calculoPrecio.precioGaraje | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-item">
                  <span>Electricidad</span>
                  <span>{{ calculoPrecio.precioElectricidad | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-item">
                  <span>Comisión plataforma (20%)</span>
                  <span>{{ calculoPrecio.comisionPlataforma | number:'1.2-2' }}€</span>
                </div>
                <div class="precio-total">
                  <span>Total</span>
                  <span>{{ calculoPrecio.precioTotal | number:'1.2-2' }}€</span>
                </div>
              </div>

              <button mat-raised-button color="primary" type="submit" 
                      [disabled]="!reservaForm.valid || !calculoPrecio"
                      class="full-width reservar-button">
                <mat-icon>check_circle</mat-icon>
                Confirmar Reserva
              </button>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>

<!-- Loading -->
<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
  <p>Cargando información del garaje...</p>
</div>
